<!--MADE BY DARRELL MUCHERI-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teacher Admin Portal - School Management System</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://i.ibb.co/yFJryv1y/mrfrankofc.jpg" />
    <link rel="icon" type="image/png" sizes="16x16" href="https://i.ibb.co/yFJryv1y/mrfrankofc.jpg" />
    <link rel="apple-touch-icon" sizes="180x180" href="https://i.ibb.co/yFJryv1y/mrfrankofc.jpg" />
    <style>
      /* Enhanced Root Variables & Themes */
      :root {
        --primary: #1a365d;
        --secondary: #d69e2e;
        --accent: #9f7aea;
        --glass: rgba(26, 54, 93, 0.15);
        --bg-gradient: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
        --text-color: #ffffff;
        --overlay: rgba(0, 0, 0, 0.5);
        --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        --header-height: 80px;
      }
      
      [data-theme="light"] {
        --primary: #3182ce;
        --secondary: #dd6b20;
        --accent: #805ad5;
        --glass: rgba(237, 242, 247, 0.9);
        --bg-gradient: linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);
        --text-color: #2d3748;
        --overlay: rgba(255, 255, 255, 0.4);
      }
      
      /* Global Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }
      
      body {
        background: var(--bg-gradient);
        color: var(--text-color);
        min-height: 100vh;
        transition: all 0.6s ease;
        line-height: 1.6;
      }
      
      /* Enhanced Header */
      header {
        background: rgba(26, 54, 93, 0.9);
        backdrop-filter: blur(12px);
        padding: 0 5%;
        height: var(--header-height);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        box-shadow: var(--card-shadow);
        border-bottom: 2px solid var(--secondary);
      }
      
      .logo {
        font-size: 1.5rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        color: white;
      }
      
      .logo span {
        color: var(--secondary);
      }
      
      .header-logo {
        height: 50px;
        margin-right: 15px;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
      }
      
      .menu-btn {
        font-size: 1.8rem;
        cursor: pointer;
        background: transparent;
        border: none;
        color: white;
        transition: transform 0.3s ease;
      }
      
      .menu-btn:hover {
        transform: scale(1.1);
        color: var(--secondary);
      }
      
      /* Enhanced Side Menu */
      .side-menu {
        position: fixed;
        top: 0;
        right: -350px;
        width: 350px;
        height: 100%;
        background: rgba(26, 54, 93, 0.95);
        backdrop-filter: blur(20px);
        padding: 2rem;
        transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 2000;
        box-shadow: -5px 0 15px rgba(0,0,0,0.1);
        border-left: 1px solid rgba(214, 158, 46, 0.3);
      display: flex;
  flex-direction: column;
  height: 100vh;
  overflow-y: auto; /* Enable vertical scrolling */
}
      
      .side-menu.active {
        right: 0;
      }
      
      .menu-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(255,255,255,0.1);
      }
      
      .menu-header h3 {
        font-size: 1.5rem;
        color: var(--secondary);
      }
      
      .close-btn {
        font-size: 1.8rem;
        cursor: pointer;
        background: transparent;
        border: none;
        color: white;
        transition: transform 0.3s ease;
      }
      
      .close-btn:hover {
        transform: rotate(90deg);
        color: var(--secondary);
      }
      
      .menu-links {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      
      .menu-links a {
        color: white;
        text-decoration: none;
        font-size: 1.1rem;
        padding: 12px 15px;
        border-radius: 8px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .menu-links a i {
        width: 25px;
        text-align: center;
      }
      
      .menu-links a:hover {
        background: rgba(214, 158, 46, 0.2);
        transform: translateX(5px);
      }
      
      .menu-links a.active {
        background: var(--secondary);
        color: #1a365d;
        font-weight: 600;
      }
      
      /* Enhanced Container & Sections */
      .container {
        padding: calc(var(--header-height) + 40px) 5% 120px;
        max-width: 1400px;
        margin: auto;
      }
      
      section {
        margin-bottom: 50px;
        background: var(--glass);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        padding: 30px;
        box-shadow: var(--card-shadow);
        border: 1px solid rgba(255,255,255,0.1);
      }
      
      section h2 {
        color: var(--secondary);
        margin-bottom: 1.5rem;
        font-size: 1.8rem;
        position: relative;
        padding-bottom: 10px;
      }
      
      section h2::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 60px;
        height: 3px;
        background: var(--secondary);
      }
      
      /* Enhanced Dashboard Section */
      #dashboard {
        text-align: center;
        background: rgba(26, 54, 93, 0.7);
      }
      
      #welcomeMessage {
        font-size: 2.5rem;
        margin-bottom: 1.5rem;
        animation: fadeIn 1s ease-in-out;
        color: white;
        text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      }
      
      #teacherStats {
        margin-bottom: 2rem;
      }
      
      /* Enhanced Stats Cards */
      .stat-card {
        background: rgba(255,255,255,0.1);
        padding: 25px;
        border-radius: 10px;
        flex: 1;
        min-width: 200px;
        transition: transform 0.3s ease;
        border: 1px solid rgba(255,255,255,0.1);
      }
      
      .stat-card:hover {
        transform: translateY(-5px);
        background: rgba(214, 158, 46, 0.1);
      }
      
      .stat-card h3 {
        font-size: 1.1rem;
        margin-bottom: 10px;
        color: var(--secondary);
      }
      
      .stat-card p {
        font-size: 2rem;
        font-weight: 700;
        color: white;
      }
      
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }
      
      /* Enhanced Form Elements */
      .form-group {
        margin-bottom: 1.5rem;
      }
      
      .form-group label {
        display: block;
        margin-bottom: 0.8rem;
        font-weight: 500;
        color: var(--secondary);
      }
      
      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 0.9rem;
        border: 1px solid rgba(255,255,255,0.2);
        border-radius: 8px;
        background: rgba(255,255,255,0.1);
        color: var(--text-color);
        font-size: 1rem;
        transition: all 0.3s ease;
      }
      
      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        border-color: var(--secondary);
        outline: none;
        box-shadow: 0 0 0 3px rgba(214, 158, 46, 0.3);
        background: rgba(255,255,255,0.15);
      }
      
      .form-group textarea {
        min-height: 150px;
        resize: vertical;
      }
      
      .form-group button {
        padding: 0.9rem 1.8rem;
        background: var(--secondary);
        color: #1a365d;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      
      .form-group button:hover {
        background: #e69c2a;
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      }
      
      .form-group button i {
        font-size: 1.1rem;
      }
      
      /* Enhanced Tables */
      .table-responsive {
        width: 100%;
        overflow-x: auto;
        margin-bottom: 30px;
        border-radius: 8px;
        box-shadow: var(--card-shadow);
      }
      
      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 900px;
        background: rgba(255,255,255,0.05);
      }
      
      table th,
      table td {
        padding: 12px 15px;
        text-align: left;
        font-size: 0.95rem;
        border: 1px solid rgba(255,255,255,0.1);
      }
      
      table th {
        background: var(--primary);
        color: white;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
      }
      
      table tr:nth-child(even) {
        background: rgba(255,255,255,0.03);
      }
      
      table tr:hover {
        background: rgba(214, 158, 46, 0.1);
      }
      
      /* Enhanced Action Buttons */
      .action-buttons {
        display: flex;
        gap: 8px;
      }
      
      .action-buttons button {
        padding: 6px 12px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.85rem;
        font-weight: 500;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 5px;
      }
      
      .action-buttons button i {
        font-size: 0.9rem;
      }
      
      .edit-btn {
        background: #38a169;
        color: white;
      }
      
      .edit-btn:hover {
        background: #2f855a;
        transform: translateY(-2px);
      }
      
      .delete-btn {
        background: #e53e3e;
        color: white;
      }
      
      .delete-btn:hover {
        background: #c53030;
        transform: translateY(-2px);
      }
      
      /* Enhanced Attendance Table */
      .attendance-table {
        width: 100%;
        margin: 20px 0;
        background: rgba(255,255,255,0.05);
      }
      
      .attendance-table th {
        background: var(--primary);
        color: white;
        text-align: center;
        padding: 10px;
      }
      
      .attendance-table td {
        text-align: center;
        padding: 10px;
      }
      
      .attendance-table input[type="checkbox"] {
        transform: scale(1.5);
        cursor: pointer;
      }
      
      /* Enhanced Notices Section */
      .notice-card {
        background: rgba(255,255,255,0.1);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        border-left: 4px solid var(--secondary);
        transition: transform 0.3s ease;
      }
      
      .notice-card:hover {
        transform: translateX(5px);
        background: rgba(255,255,255,0.15);
      }
      
      .notice-card h3 {
        color: var(--secondary);
        margin-bottom: 10px;
        font-size: 1.3rem;
      }
      
      .notice-card p {
        margin-bottom: 15px;
        line-height: 1.7;
      }
      
      .notice-card small {
        color: rgba(255,255,255,0.7);
        font-size: 0.85rem;
        display: block;
        margin-top: 10px;
      }
      
      .notice-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }
      
      .notice-actions button {
        padding: 8px 15px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 5px;
      }
      
      .notice-actions .edit-notice {
        background: #4299e1;
        color: white;
      }
      
      .notice-actions .edit-notice:hover {
        background: #3182ce;
      }
      
      .notice-actions .delete-notice {
        background: #e53e3e;
        color: white;
      }
      
      .notice-actions .delete-notice:hover {
        background: #c53030;
      }
      
      /* Enhanced Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 3000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: var(--overlay);
        backdrop-filter: blur(5px);
      }
      
      .modal-content {
        background-color: var(--glass);
        margin: 8% auto;
        padding: 30px;
        border-radius: 12px;
        width: 90%;
        max-width: 600px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        border: 1px solid rgba(255,255,255,0.1);
        animation: modalFadeIn 0.4s ease-out;
      }
      
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
      }
      
      .modal-header h2 {
        color: var(--secondary);
        margin: 0;
      }
      
      .close {
        color: #aaa;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s ease;
      }
      
      .close:hover,
      .close:focus {
        color: var(--secondary);
        text-decoration: none;
      }
      
      .modal-body {
        margin-bottom: 25px;
      }
      
      .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        padding-top: 20px;
        border-top: 1px solid rgba(255,255,255,0.1);
      }
      
      /* Enhanced Settings Section */
      .profile-picture-container {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
      }
      
      .profile-picture {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid var(--secondary);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      }
      
      .profile-upload {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      
      /* Enhanced Footer */
      footer {
        background: rgba(26, 54, 93, 0.9);
        color: white;
        padding: 1.5rem 5%;
        text-align: center;
        position: fixed;
        width: 100%;
        bottom: 0;
        z-index: 100;
        border-top: 1px solid rgba(214, 158, 46, 0.3);
      }
      
      .social-icons {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 15px;
      }
      
      .social-icons a {
        color: white;
        font-size: 1.3rem;
        transition: all 0.3s ease;
      }
      
      .social-icons a:hover {
        color: var(--secondary);
        transform: translateY(-3px);
      }
      
      footer p {
        margin: 5px 0;
        font-size: 0.9rem;
        opacity: 0.8;
      }
      
      footer a {
        color: var(--secondary);
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
      }
      
      footer a:hover {
        text-decoration: underline;
      }
      
      /* Enhanced Theme Toggle */
      .theme-toggle {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--primary);
        backdrop-filter: blur(8px);
        border: 2px solid var(--secondary);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        z-index: 1000;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      }
      
      .theme-toggle:hover {
        transform: scale(1.1) rotate(15deg);
        box-shadow: 0 6px 8px rgba(0,0,0,0.15);
      }
      
      .theme-toggle i {
        font-size: 1.6rem;
        color: var(--secondary);
      }
      
      /* Animation Keyframes */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      @keyframes modalFadeIn {
        from { opacity: 0; transform: translateY(-30px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }
      
      /* Responsive Adjustments */
      @media (max-width: 768px) {
        .container {
          padding: calc(var(--header-height) + 20px) 3% 120px;
        }
        
        section {
          padding: 20px;
        }
        
        #welcomeMessage {
          font-size: 2rem;
        }
        
        .stats-grid {
          grid-template-columns: 1fr;
        }
        
        .side-menu {
          width: 280px;
        }
      }
      
      /* Utility Classes */
      .text-center {
        text-align: center;
      }
      
      .mt-3 {
        margin-top: 1rem;
      }
      
      .mb-3 {
        margin-bottom: 1rem;
      }
      
      .flex {
        display: flex;
      }
      
      .justify-between {
        justify-content: space-between;
      }
      
      .items-center {
        align-items: center;
      }
    </style>
  </head>
  <body>
    <!-- Enhanced Header -->
    <header>
      <div class="logo">
        <img src="https://i.postimg.cc/mZ81jqGW/In-Shot-20250227-051117557.jpg" alt="Logo" class="header-logo" />
        <span>Teacher</span> Admin Portal
      </div>
      <button class="menu-btn" id="menuBtn">
        <i class="fas fa-user-cog"></i>
      </button>
    </header>

    <!-- Enhanced Side Menu -->
    <div class="side-menu" id="sideMenu">
      <div class="menu-header">
        <h3>Admin Controls</h3>
        <button class="close-btn" id="closeBtn">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="menu-links">
        <a href="#dashboard" class="active">
          <i class="fas fa-tachometer-alt"></i> Dashboard
        </a>
        <a href="/fees">
          <i class="fas fa-money-bill-wave"></i> Fees Payment
        </a>
        <a href="/setreportcard">
          <i class="fas fa-file-alt"></i> Set Report Cards
        </a>
        <a href="/adminapplication">
          <i class="fas fa-users"></i> View Applications
        </a>
        <a href="/viewreports">
          <i class="fas fa-chart-bar"></i> View Reports
        </a>
        <a href="#addUpdate">
          <i class="fas fa-bullhorn"></i> Add Notice
        </a>
        <a href="#updates">
          <i class="fas fa-clipboard-list"></i> Manage Notices
        </a>
        <a href="/studentusers">
          <i class="fas fa-user-graduate"></i> Student Management
        </a>
        <a href="/teacherusers">
          <i class="fas fa-chalkboard-teacher"></i> Teacher Management
        </a>
        <a href="#settings">
          <i class="fas fa-cog"></i> Settings
        </a>
        <a href="/teacherslogin" id="logoutBtn">
          <i class="fas fa-sign-out-alt"></i> Logout
        </a>
      </div>
    </div>

    <!-- Main Content Container -->
    <div class="container">
      <!-- Dashboard Section -->
      <section id="dashboard">
        <h2 id="welcomeMessage">Welcome, Administrator!</h2>
        <div id="teacherStats">
          <!-- Dynamic teacher stats will load here -->
        </div>
      </section>

      <!-- Attendance Section -->
      <section id="attendance" style="display: none;">
        <h2><i class="fas fa-calendar-check"></i> Attendance Management</h2>
        <form id="attendanceForm">
          <div class="form-group">
            <label for="attendanceStudent"><i class="fas fa-user-graduate"></i> Select Student:</label>
            <select id="attendanceStudent" required>
              <option value="">Select Student</option>
            </select>
          </div>
          
          <div class="flex justify-between items-center" style="gap: 20px;">
            <div class="form-group" style="flex: 1;">
              <label for="attendanceYear"><i class="fas fa-calendar"></i> Academic Year:</label>
              <input type="text" id="attendanceYear" placeholder="e.g., 2025" required />
            </div>
            
            <div class="form-group" style="flex: 1;">
              <label for="attendanceTerm"><i class="fas fa-book"></i> Term:</label>
              <select id="attendanceTerm" required>
                <option value="">Select Term</option>
                <option value="Term 1">Term 1</option>
                <option value="Term 2">Term 2</option>
                <option value="Term 3">Term 3</option>
              </select>
            </div>
            
            <div class="form-group" style="flex: 1;">
              <label for="attendanceMonth"><i class="fas fa-calendar-alt"></i> Month:</label>
              <select id="attendanceMonth" required>
                <option value="">Select Month</option>
                <option value="January">January</option>
                <option value="February">February</option>
                <option value="March">March</option>
                <option value="April">April</option>
                <option value="May">May</option>
                <option value="June">June</option>
                <option value="July">July</option>
                <option value="August">August</option>
                <option value="September">September</option>
                <option value="October">October</option>
                <option value="November">November</option>
                <option value="December">December</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <p class="mb-3"><i class="fas fa-info-circle"></i> Mark attendance for 4 weeks (Mon - Fri):</p>
            <div class="table-responsive">
              <table class="attendance-table">
                <thead>
                  <tr>
                    <th>Week</th>
                    <th>Mon</th>
                    <th>Tue</th>
                    <th>Wed</th>
                    <th>Thu</th>
                    <th>Fri</th>
                  </tr>
                </thead>
                <tbody id="attendanceTableBody">
                  <!-- Dynamically generated attendance rows -->
                </tbody>
              </table>
            </div>
          </div>
          
          <div class="form-group text-center">
            <button type="submit">
              <i class="fas fa-save"></i> Save Attendance
            </button>
          </div>
        </form>
        <div id="attendanceResult" class="text-center"></div>
      </section>

      <!-- Grades Section -->
      <section id="grades" style="display: none;">
        <h2><i class="fas fa-graduation-cap"></i> Set Report Card</h2>
        <form id="gradeForm">
          <div class="form-group">
            <label for="gradeStudent"><i class="fas fa-user-graduate"></i> Select Student:</label>
            <select id="gradeStudent" required>
              <option value="">Select Student</option>
            </select>
          </div>
          
          <div class="flex justify-between items-center" style="gap: 20px;">
            <div class="form-group" style="flex: 1;">
              <label for="studentClass"><i class="fas fa-users-class"></i> Class:</label>
              <input type="text" id="studentClass" placeholder="Enter Class" required />
            </div>
            
            <div class="form-group" style="flex: 1;">
              <label for="gradeYear"><i class="fas fa-calendar"></i> Year:</label>
              <input type="text" id="gradeYear" placeholder="e.g., 2025" required />
            </div>
            
            <div class="form-group" style="flex: 1;">
              <label for="gradeTerm"><i class="fas fa-book"></i> Term:</label>
              <select id="gradeTerm" required>
                <option value="">Select Term</option>
                <option value="Term 1">Term 1</option>
                <option value="Term 2">Term 2</option>
                <option value="Term 3">Term 3</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="finalGrade"><i class="fas fa-star"></i> Final Grade:</label>
            <select id="finalGrade" required>
              <option value="">Select Grade</option>
              <option value="A">A (Excellent)</option>
              <option value="B">B (Good)</option>
              <option value="C">C (Average)</option>
              <option value="D">D (Below Average)</option>
              <option value="F">F (Fail)</option>
            </select>
          </div>
          
          <div class="form-group text-center">
            <button type="submit">
              <i class="fas fa-save"></i> Save Grade
            </button>
          </div>
        </form>
        <div id="gradeResult" class="text-center"></div>
      </section>

      <!-- Add Update / Notice Section -->
      <section id="addUpdate" style="display: none;">
        <h2><i class="fas fa-bullhorn"></i> Create New Notice</h2>
        <form id="updateForm">
          <div class="form-group">
            <label for="teacherName"><i class="fas fa-user-tie"></i> Teacher Name:</label>
            <input type="text" id="teacherName" placeholder="Enter your name" required />
          </div>
          
          <div class="form-group">
            <label for="updateTitle"><i class="fas fa-heading"></i> Notice Title:</label>
            <input type="text" id="updateTitle" placeholder="Enter notice title" required />
          </div>
          
          <div class="form-group">
            <label for="updateContent"><i class="fas fa-align-left"></i> Notice Content:</label>
            <textarea id="updateContent" rows="6" placeholder="Enter notice content..." required></textarea>
          </div>
          
          <div class="flex justify-between items-center" style="gap: 20px;">
            <div class="form-group" style="flex: 1;">
              <label for="updateYear"><i class="fas fa-calendar"></i> Year:</label>
              <input type="text" id="updateYear" placeholder="e.g., 2025" required />
            </div>
            
            <div class="form-group" style="flex: 1;">
              <label for="updateTerm"><i class="fas fa-book"></i> Term:</label>
              <select id="updateTerm" required>
                <option value="">Select Term</option>
                <option value="Term 1">Term 1</option>
                <option value="Term 2">Term 2</option>
                <option value="Term 3">Term 3</option>
              </select>
            </div>
          </div>
          
          <div class="form-group text-center">
            <button type="submit">
              <i class="fas fa-paper-plane"></i> Publish Notice
            </button>
          </div>
        </form>
        <div id="updateResult" class="text-center"></div>
      </section>

      <!-- View/Manage Notices Section -->
      <section id="updates" style="display: none;">
        <h2><i class="fas fa-clipboard-list"></i> Manage Notices</h2>
        <div id="updatesList">
          <!-- Notices will be loaded here dynamically -->
        </div>
      </section>

      <!-- Student Management Section -->
      <section id="studentManagement" style="display: none;">
        <h2><i class="fas fa-user-graduate"></i> Student Records</h2>
        <div id="notification" class="notification"></div>
        <div class="total-count" id="totalCount">Total Students: 0</div>
        <div id="studentsList">
          <!-- Grouped student tables will be appended here -->
        </div>
        
        <!-- Edit Student Modal -->
        <div id="editModal" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <h2><i class="fas fa-user-edit"></i> Edit Student</h2>
              <span class="close" id="editModalClose">&times;</span>
            </div>
            <div class="modal-body">
              <form id="editForm">
                <input type="hidden" id="editStudentId" />
                <div class="form-group">
                  <label for="editFirstName">First Name:</label>
                  <input type="text" id="editFirstName" required />
                </div>
                <div class="form-group">
                  <label for="editSurname">Surname:</label>
                  <input type="text" id="editSurname" required />
                </div>
                <div class="form-group">
                  <label for="editPhone">Phone:</label>
                  <input type="text" id="editPhone" required />
                </div>
                <div class="form-group">
                  <label for="editEmail">Email:</label>
                  <input type="email" id="editEmail" required />
                </div>
                <div class="form-group">
                  <label for="editParentName">Parent Name:</label>
                  <input type="text" id="editParentName" />
                </div>
                <div class="form-group">
                  <label for="editParentPhone">Parent Phone:</label>
                  <input type="text" id="editParentPhone" />
                </div>
                <div class="form-group">
                  <label for="editDob">Date of Birth:</label>
                  <input type="date" id="editDob" />
                </div>
                <div class="form-group">
                  <label for="editGender">Gender:</label>
                  <select id="editGender">
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="editAddress">Address:</label>
                  <input type="text" id="editAddress" />
                </div>
                <div class="form-group">
                  <label for="editUserPass">Password:</label>
                  <input type="password" id="editUserPass" />
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" id="cancelEdit" class="edit-btn">
                <i class="fas fa-times"></i> Cancel
              </button>
              <button type="submit" form="editForm" class="edit-btn">
                <i class="fas fa-save"></i> Save Changes
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Settings Section -->
      <section id="settings" style="display: none;">
        <h2><i class="fas fa-cog"></i> Account Settings</h2>
        <form id="settingsForm">
          <div class="profile-picture-container">
            <img
              id="profilePicPreview"
              src="https://i.postimg.cc/28gm27sy/2993763.png"
              alt="Profile Picture"
              class="profile-picture"
            />
            <div class="profile-upload">
              <label for="profilePic" class="edit-btn" style="cursor: pointer;">
                <i class="fas fa-camera"></i> Change Photo
              </label>
              <input type="file" id="profilePic" accept="image/*" style="display: none;" />
              <small>Recommended size: 500x500px</small>
            </div>
          </div>
          
          <div class="flex justify-between items-center" style="gap: 20px;">
            <div class="form-group" style="flex: 1;">
              <label for="firstName">First Name:</label>
              <input type="text" id="firstName" required />
            </div>
            <div class="form-group" style="flex: 1;">
              <label for="surname">Surname:</label>
              <input type="text" id="surname" required />
            </div>
          </div>
          
          <div class="form-group">
            <label for="emailInfo">Email:</label>
            <input type="email" id="emailInfo" required />
          </div>
          
          <div class="form-group">
            <label for="newPassword">New Password:</label>
            <input type="password" id="newPassword" placeholder="Leave blank if not changing" />
            <small class="mt-3">Password must be at least 8 characters long</small>
          </div>
          
          <div class="form-group text-center">
            <button type="submit">
              <i class="fas fa-save"></i> Update Profile
            </button>
          </div>
        </form>
      </section>
    </div>

    <!-- Footer -->
    <footer>
      <div class="social-icons">
        <a href="#"><i class="fab fa-facebook"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-linkedin"></i></a>
      </div>
      <p>
        <a
          href="https://wa.me/263719647303?text=hi%20darrell%20i%20would%20want%20you%20to%20create%20me%20a%20site%20like%20that%20of%20st%20marys.%20It%20wonderful"
          target="_blank"
          >Made By Darrell Mucheri</a
        >
      </p>
      <p>&copy; 2025 St. Mary's High School. All rights reserved.</p>
    </footer>

    <!-- Theme Toggle -->
    <div class="theme-toggle" id="themeToggle">
      <i class="fas fa-moon"></i>
    </div>

    <!-- Firebase & Application Scripts -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getAuth,
        signOut,
        onAuthStateChanged,
        updatePassword
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import {
        getFirestore,
        collection,
        getDocs,
        doc,
        setDoc,
        addDoc,
        deleteDoc,
        updateDoc,
        getDoc,
        query,
        orderBy
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAR9J2Wz7Eu8dXRzDG8JNHcymLCUQUPJRo",
        authDomain: "deee-9ab53.firebaseapp.com",
        projectId: "deee-9ab53",
        storageBucket: "deee-9ab53.firebasestorage.app",
        messagingSenderId: "399732664479",
        appId: "1:399732664479:web:b84ac30e8266cc51761aaa",
        measurementId: "G-524ZPBX42B"
      };

      const appFirebase = initializeApp(firebaseConfig);
      const auth = getAuth(appFirebase);
      const db = getFirestore(appFirebase);

      /* --------------------- Enhanced Teacher Dashboard Functions --------------------- */
      async function loadTeacherStats() {
  try {
    // Get all necessary data in parallel for better performance
    const [studentsSnapshot, updatesSnapshot, usersSnapshot] = await Promise.all([
      getDocs(collection(db, "students")),
      getDocs(collection(db, "updates")),
      getDocs(collection(db, "users"))
    ]);

    // Count teachers (users with role 'teacher' or 'admin')
    let totalTeachers = 0;
    usersSnapshot.forEach((docSnap) => {
      const data = docSnap.data();
      if (data.role && (data.role.toLowerCase() === 'teacher' || data.role.toLowerCase() === 'admin')) {
        totalTeachers++;
      }
    });

    const totalStudents = studentsSnapshot.size;
    const totalNotices = updatesSnapshot.size;

    // Create the stats HTML
    const statsHTML = `
      <div class="stats-grid">
        <div class="stat-card">
          <h3><i class="fas fa-chalkboard-teacher"></i> Total Teachers</h3>
          <p>${totalTeachers}</p>
        </div>
        <div class="stat-card">
          <h3><i class="fas fa-user-graduate"></i> Total Students</h3>
          <p>${totalStudents}</p>
        </div>
        <div class="stat-card">
          <h3><i class="fas fa-bullhorn"></i> Total Notices</h3>
          <p>${totalNotices}</p>
        </div>
      </div>
    `;

    // Insert into the page
    document.getElementById("teacherStats").innerHTML = statsHTML;

  } catch (error) {
    console.error("Error loading teacher stats:", error);
    document.getElementById("teacherStats").innerHTML = `
      <div class="notification error">
        <i class="fas fa-exclamation-circle"></i> Error loading statistics: ${error.message}
      </div>
    `;
  }
}

  /* --------------------- Enhanced Notice Management --------------------- */
      async function loadUpdates() {
        try {
          const q = query(collection(db, "updates"), orderBy("timestamp", "desc"));
          const updatesSnapshot = await getDocs(q);
          let html = "";
          
          updatesSnapshot.forEach((docSnap) => {
            const update = docSnap.data();
            const date = update.timestamp ? new Date(update.timestamp.seconds * 1000).toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            }) : "No date available";
            
            html += `
              <div class="notice-card">
                <h3>${update.updateTitle || "Untitled Notice"}</h3>
                <p>${update.updateContent || "No content provided"}</p>
                <small>Posted by ${update.teacherName || "Unknown"} | ${date}</small>
                <div class="notice-actions">
                  <button class="edit-notice" onclick="editNotice('${docSnap.id}')">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                  <button class="delete-notice" onclick="deleteNotice('${docSnap.id}')">
                    <i class="fas fa-trash"></i> Delete
                  </button>
                </div>
              </div>
            `;
          });
          
          document.getElementById("updatesList").innerHTML = html || `
            <div class="notification notice">
              <i class="fas fa-info-circle"></i> No notices available
            </div>
          `;
        } catch (error) {
          console.error("Error loading updates:", error);
          document.getElementById("updatesList").innerHTML = `
            <div class="notification error">
              <i class="fas fa-exclamation-circle"></i> Error loading notices
            </div>
          `;
        }
      }

      window.deleteNotice = async function(noticeId) {
        if (confirm("Are you sure you want to delete this notice? This action cannot be undone.")) {
          try {
            await deleteDoc(doc(db, "updates", noticeId));
            showNotification("Notice deleted successfully", "success");
            loadUpdates();
          } catch (error) {
            console.error("Error deleting notice:", error);
            showNotification("Error deleting notice", "error");
          }
        }
      };

      window.editNotice = function(noticeId) {
        // Implementation for editing notices
        showNotification("Edit feature coming soon", "notice");
      };

      /* --------------------- Enhanced Attendance Management --------------------- */
      async function populateStudentDropdowns() {
        try {
          const querySnapshot = await getDocs(collection(db, "students"));
          let options = '<option value="">Select Student</option>';
          querySnapshot.forEach((docSnap) => {
            const data = docSnap.data();
            options += `
              <option value="${data.email}">
                ${data.firstname || ""} ${data.surname || ""} (${data.email})
              </option>
            `;
          });
          document.getElementById("attendanceStudent").innerHTML = options;
          document.getElementById("gradeStudent").innerHTML = options;
        } catch (error) {
          console.error("Error populating student dropdowns:", error);
          showNotification("Error loading student list", "error");
        }
      }

      function generateAttendanceRows() {
        const attendanceTableBody = document.getElementById("attendanceTableBody");
        let tableRows = "";
        for (let week = 1; week <= 4; week++) {
          tableRows += `
            <tr>
              <td>Week ${week}</td>
              <td><input type="checkbox" class="attendanceCheckbox" data-week="${week}" data-day="Monday" /></td>
              <td><input type="checkbox" class="attendanceCheckbox" data-week="${week}" data-day="Tuesday" /></td>
              <td><input type="checkbox" class="attendanceCheckbox" data-week="${week}" data-day="Wednesday" /></td>
              <td><input type="checkbox" class="attendanceCheckbox" data-week="${week}" data-day="Thursday" /></td>
              <td><input type="checkbox" class="attendanceCheckbox" data-week="${week}" data-day="Friday" /></td>
            </tr>
          `;
        }
        attendanceTableBody.innerHTML = tableRows;
      }

      document.getElementById("attendanceForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const studentEmail = document.getElementById("attendanceStudent").value;
        const year = document.getElementById("attendanceYear").value;
        const term = document.getElementById("attendanceTerm").value;
        const month = document.getElementById("attendanceMonth").value;
        
        if (!studentEmail || !year || !term || !month) {
          showNotification("Please fill all required fields", "error");
          return;
        }

        const checkboxes = document.querySelectorAll(".attendanceCheckbox");
        let presentCount = 0;
        checkboxes.forEach((checkbox) => {
          if (checkbox.checked) presentCount++;
        });
        
        const totalDays = checkboxes.length;
        const percentage = ((presentCount / totalDays) * 100).toFixed(2);

        let attendanceData = {};
        for (let week = 1; week <= 4; week++) {
          attendanceData["week" + week] = {};
          ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"].forEach((day) => {
            const checkbox = document.querySelector(
              `.attendanceCheckbox[data-week="${week}"][data-day="${day}"]`
            );
            attendanceData["week" + week][day] = checkbox.checked;
          });
        }

        const docId = `${studentEmail}_${year}_${term}_${month}`;
        try {
          await setDoc(doc(db, "attendance", docId), {
            studentEmail,
            year,
            term,
            month,
            attendance: attendanceData,
            percentage: Number(percentage),
            lastUpdated: new Date()
          });
          
          document.getElementById("attendanceResult").innerHTML = `
            <div class="notification success">
              <i class="fas fa-check-circle"></i> Attendance saved successfully! 
              Attendance Percentage: <strong>${percentage}%</strong>
            </div>
          `;
          
          // Reset form
          document.getElementById("attendanceForm").reset();
          generateAttendanceRows();
        } catch (error) {
          console.error("Error saving attendance:", error);
          document.getElementById("attendanceResult").innerHTML = `
            <div class="notification error">
              <i class="fas fa-exclamation-circle"></i> Error saving attendance: ${error.message}
            </div>
          `;
        }
      });

      /* --------------------- Enhanced Notice Posting --------------------- */
      document.getElementById("updateForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const teacherName = document.getElementById("teacherName").value;
        const updateTitle = document.getElementById("updateTitle").value;
        const updateContent = document.getElementById("updateContent").value;
        const updateYear = document.getElementById("updateYear").value;
        const updateTerm = document.getElementById("updateTerm").value;
        
        if (!teacherName || !updateTitle || !updateContent || !updateYear || !updateTerm) {
          showNotification("Please fill all required fields", "error");
          return;
        }

        try {
          await addDoc(collection(db, "updates"), {
            teacherName,
            updateTitle,
            updateContent,
            updateYear,
            updateTerm,
            timestamp: new Date()
          });
          
          document.getElementById("updateResult").innerHTML = `
            <div class="notification success">
              <i class="fas fa-check-circle"></i> Notice posted successfully!
            </div>
          `;
          
          // Reset form
          document.getElementById("updateForm").reset();
        } catch (error) {
          console.error("Error posting update:", error);
          document.getElementById("updateResult").innerHTML = `
            <div class="notification error">
              <i class="fas fa-exclamation-circle"></i> Error posting notice: ${error.message}
            </div>
          `;
        }
      });

      /* --------------------- Enhanced Student Management --------------------- */
      let studentsData = [];
      
      function showNotification(message, type = "notice") {
        const notification = document.getElementById("notification");
        notification.innerHTML = `
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
          ${message}
        `;
        notification.className = `notification ${type}`;
        notification.style.display = "flex";
        setTimeout(() => {
          notification.style.display = "none";
        }, 5000);
      }

      async function loadStudents() {
        try {
          const querySnapshot = await getDocs(collection(db, "students"));
          let students = [];
          querySnapshot.forEach((docSnap) => {
            const data = docSnap.data();
            data.id = docSnap.id;
            students.push(data);
          });
          
          students.sort((a, b) => {
            const nameA = (a.firstname || "").toLowerCase();
            const nameB = (b.firstname || "").toLowerCase();
            if (nameA < nameB) return -1;
            if (nameA > nameB) return 1;
            return 0;
          });
          
          studentsData = students;
          const groups = {};
          
          students.forEach((student) => {
            const groupKey = `${student.form || "Not set"} - ${student.stream || "Not set"}`;
            if (!groups[groupKey]) {
              groups[groupKey] = [];
            }
            groups[groupKey].push(student);
          });
          
          document.getElementById("totalCount").textContent = `Total Students: ${students.length}`;
          const container = document.getElementById("studentsList");
          container.innerHTML = "";
          
          for (const group in groups) {
            const groupDiv = document.createElement("div");
            groupDiv.classList.add("group-section");
            groupDiv.innerHTML = `<h3 style="margin: 20px 0 10px; color: var(--secondary);">${group}</h3>`;
            
            const tableWrapper = document.createElement("div");
            tableWrapper.classList.add("table-responsive");
            
            const table = document.createElement("table");
            const thead = document.createElement("thead");
            thead.innerHTML = `
              <tr>
                <th>#</th>
                <th>First Name</th>
                <th>Surname</th>
                <th>Email</th>
                <th>Class</th>
                <th>Actions</th>
              </tr>
            `;
            
            table.appendChild(thead);
            const tbody = document.createElement("tbody");
            
            groups[group].forEach((student, index) => {
              const tr = document.createElement("tr");
              tr.innerHTML = `
                <td>${index + 1}</td>
                <td>${student.firstname || "-"}</td>
                <td>${student.surname || "-"}</td>
                <td>${student.email || "-"}</td>
                <td>${student.form || "-"} ${student.stream || ""}</td>
                <td class="action-buttons">
                  <button class="edit-btn" onclick="editStudent('${student.id}')">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                  <button class="delete-btn" onclick="deleteStudent('${student.id}')">
                    <i class="fas fa-trash"></i> Delete
                  </button>
                </td>
              `;
              tbody.appendChild(tr);
            });
            
            table.appendChild(tbody);
            tableWrapper.appendChild(table);
            groupDiv.appendChild(tableWrapper);
            container.appendChild(groupDiv);
          }
        } catch (error) {
          console.error("Error loading students:", error);
          showNotification("Error loading students: " + error.message, "error");
        }
      }

      window.deleteStudent = async function(studentId) {
        if (confirm("Are you sure you want to delete this student? This action cannot be undone.")) {
          try {
            await deleteDoc(doc(db, "students", studentId));
            showNotification("Student deleted successfully", "success");
            loadStudents();
          } catch (error) {
            console.error("Error deleting student:", error);
            showNotification("Error deleting student", "error");
          }
        }
      };

      window.editStudent = function(studentId) {
        const student = studentsData.find((s) => s.id === studentId);
        if (!student) {
          showNotification("Student not found", "error");
          return;
        }
        
        document.getElementById("editStudentId").value = student.id;
        document.getElementById("editFirstName").value = student.firstname || "";
        document.getElementById("editSurname").value = student.surname || "";
        document.getElementById("editPhone").value = student.phone || "";
        document.getElementById("editEmail").value = student.email || "";
        document.getElementById("editParentName").value = student.parentName || "";
        document.getElementById("editParentPhone").value = student.parentPhone || "";
        document.getElementById("editDob").value = student.dob || "";
        document.getElementById("editGender").value = student.gender || "";
        document.getElementById("editAddress").value = student.address || "";
        document.getElementById("editUserPass").value = student.userPass || "";
        
        document.getElementById("editModal").style.display = "block";
      };

      document.getElementById("editModalClose").addEventListener("click", () => {
        document.getElementById("editModal").style.display = "none";
      });
      
      document.getElementById("cancelEdit").addEventListener("click", () => {
        document.getElementById("editModal").style.display = "none";
      });
      
      document.getElementById("editForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const studentId = document.getElementById("editStudentId").value;
        
        const updatedData = {
          firstname: document.getElementById("editFirstName").value,
          surname: document.getElementById("editSurname").value,
          phone: document.getElementById("editPhone").value,
          email: document.getElementById("editEmail").value,
          parentName: document.getElementById("editParentName").value,
          parentPhone: document.getElementById("editParentPhone").value,
          dob: document.getElementById("editDob").value,
          gender: document.getElementById("editGender").value,
          address: document.getElementById("editAddress").value,
          userPass: document.getElementById("editUserPass").value,
          lastUpdated: new Date()
        };
        
        try {
          await updateDoc(doc(db, "students", studentId), updatedData);
          showNotification("Student updated successfully", "success");
          document.getElementById("editModal").style.display = "none";
          loadStudents();
        } catch (error) {
          console.error("Error updating student:", error);
          showNotification("Error updating student", "error");
        }
      });

      /* --------------------- Enhanced Navigation --------------------- */
      const menuBtn = document.getElementById("menuBtn");
      const sideMenu = document.getElementById("sideMenu");
      const closeBtn = document.getElementById("closeBtn");
      
      menuBtn.addEventListener("click", () => {
        sideMenu.classList.toggle("active");
      });
      
      closeBtn.addEventListener("click", () => {
        sideMenu.classList.remove("active");
      });
      
      document.addEventListener("click", (e) => {
        if (!sideMenu.contains(e.target) && !menuBtn.contains(e.target)) {
          sideMenu.classList.remove("active");
        }
      });
      
      const menuLinks = document.querySelectorAll(".menu-links a");
      menuLinks.forEach((link) => {
        link.addEventListener("click", (e) => {
          const targetHref = link.getAttribute("href");
          if (targetHref.startsWith("#")) {
            e.preventDefault();
            const targetId = targetHref.substring(1);
            
            // Update active menu item
            menuLinks.forEach(l => l.classList.remove("active"));
            link.classList.add("active");
            
            // Show target section
            document.querySelectorAll("section").forEach((sec) => {
              sec.style.display = sec.id === targetId ? "block" : "none";
            });
            
            sideMenu.classList.remove("active");
            
            // Load data if needed
            if (targetId === "updates") {
              loadUpdates();
            } else if (targetId === "studentManagement") {
              loadStudents();
            } else if (targetId === "dashboard") {
              loadTeacherStats();
            } else if (targetId === "attendance") {
              populateStudentDropdowns();
              generateAttendanceRows();
            }
          }
        });
      });
      
      document.getElementById("logoutBtn").addEventListener("click", async (e) => {
        e.preventDefault();
        try {
          await signOut(auth);
          window.location.href = "/teacherslogin";
        } catch (error) {
          console.error("Logout error:", error);
          showNotification("Error during logout", "error");
        }
      });

      /* --------------------- Enhanced Theme Toggle --------------------- */
      const themeToggle = document.getElementById("themeToggle");
      let isDark = true;
      
      themeToggle.addEventListener("click", () => {
        isDark = !isDark;
        document.body.setAttribute("data-theme", isDark ? "dark" : "light");
        themeToggle.innerHTML = isDark
          ? '<i class="fas fa-moon"></i>'
          : '<i class="fas fa-sun"></i>';
        localStorage.setItem("theme", isDark ? "dark" : "light");
      });
      
      if (localStorage.getItem("theme")) {
        const savedTheme = localStorage.getItem("theme");
        document.body.setAttribute("data-theme", savedTheme);
        isDark = savedTheme === "dark";
        themeToggle.innerHTML = isDark
          ? '<i class="fas fa-moon"></i>'
          : '<i class="fas fa-sun"></i>';
      }

      /* --------------------- Enhanced Auth & Initialization --------------------- */
      


// Auth state checker function
function checkAuthState() {
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      // No user logged in, redirect to login
      window.location.href = "/teacherslogin";
      return;
    }

    // Get user document from Firestore
    const userDoc = await getDoc(doc(db, "users", user.uid));
    
    if (!userDoc.exists()) {
      // User document doesn't exist, log out
      await signOut(auth);
      window.location.href = "/teacherslogin";
      return;
    }

    const userData = userDoc.data();
    
    // Check if user is a student (shouldn't have access)
    if (userData.role && userData.role.toLowerCase() === "student") {
      // Log out student users immediately
      await signOut(auth);
      
      // Show message and redirect
      Swal.fire({
        icon: 'error',
        title: 'Access Denied',
        text: 'Students cannot access the admin portal',
        confirmButtonColor: '#d69e2e'
      }).then(() => {
        window.location.href = "/studentlogin"; // Redirect to student login
      });
      return;
    }

    // For teachers/admins, you can optionally show their role
    const welcomeMessage = document.getElementById("welcomeMessage");
    if (welcomeMessage) {
      welcomeMessage.innerHTML = `Welcome, <span>${userData.firstname || user.email.split('@')[0]}</span> (${userData.role || 'teacher'})!`;
    }
  });
}

// Call this when your page loads
checkAuthState();

// Add this to your logout button handler
document.getElementById("logoutBtn").addEventListener("click", async (e) => {
  e.preventDefault();
  try {
    await signOut(auth);
    window.location.href = "/teacherslogin";
  } catch (error) {
    console.error("Logout error:", error);
    Swal.fire({
      icon: 'error',
      title: 'Logout Failed',
      text: error.message,
      confirmButtonColor: '#d69e2e'
    });
  }
});
     /* --------------------- Enhanced Teacher Profile Settings --------------------- */
      async function loadTeacherProfile() {
        try {
          const user = auth.currentUser;
          if (!user) return;
          
          const docRef = doc(db, "users", user.uid);
          const docSnap = await getDoc(docRef);
          
          if (docSnap.exists()) {
            const data = docSnap.data();
            document.getElementById("firstName").value = data.firstname || "";
            document.getElementById("surname").value = data.surname || "";
            document.getElementById("emailInfo").value = data.email || "";
            document.getElementById("teacherName").value = `${data.firstname || ""} ${data.surname || ""}`.trim();
            
            if (data.profilePic) {
              document.getElementById("profilePicPreview").src = data.profilePic;
            }
          }
        } catch (error) {
          console.error("Error loading teacher profile:", error);
        }
      }

      // Profile picture upload
      document.getElementById("profilePic").addEventListener("change", function() {
        const file = this.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            document.getElementById("profilePicPreview").src = e.target.result;
            document.getElementById("profilePicPreview").dataset.base64 = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      // Profile update
      // Add this CSS to your style section
const loadingStyle = document.createElement('style');
loadingStyle.textContent = `
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  .loading-spinner {
    border: 5px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top: 5px solid var(--secondary);
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  .success-message {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #38a169;
    color: white;
    padding: 15px 25px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 1000;
    animation: slideIn 0.3s ease-out;
  }
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
`;
document.head.appendChild(loadingStyle);

// Enhanced save profile function
document.getElementById("settingsForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  
  // Show loading overlay
  const loadingOverlay = document.createElement('div');
  loadingOverlay.className = 'loading-overlay';
  loadingOverlay.innerHTML = '<div class="loading-spinner"></div>';
  document.body.appendChild(loadingOverlay);
  
  const user = auth.currentUser;
  if (!user) {
    loadingOverlay.remove();
    showError("User not authenticated. Please login again.");
    return;
  }

  try {
    // Get form values
    const firstname = document.getElementById("firstName").value.trim();
    const surname = document.getElementById("surname").value.trim();
    const email = document.getElementById("emailInfo").value.trim();
    const newPassword = document.getElementById("newPassword").value.trim();
    
    // Validate required fields
    if (!firstname || !surname || !email) {
      loadingOverlay.remove();
      showError("Please fill all required fields");
      return;
    }

    // Get profile picture (use existing if no new one selected)
    const profilePicPreview = document.getElementById("profilePicPreview");
    const profilePicBase64 = profilePicPreview.dataset.base64 || profilePicPreview.src;

    // Prepare update data
    const updatedProfile = {
      profilePic: profilePicBase64,
      firstname,
      surname,
      email,
      lastUpdated: new Date()
    };

    // Update Firestore document
    await setDoc(doc(db, "users", user.uid), updatedProfile, { merge: true });
    
    // Update password if provided and valid
    if (newPassword) {
      if (newPassword.length < 8) {
        loadingOverlay.remove();
        showError("Password must be at least 8 characters");
        return;
      }
      await updatePassword(user, newPassword);
    }
    
    // Remove loading overlay
    loadingOverlay.remove();
    
    // Show success message
    const successMsg = document.createElement('div');
    successMsg.className = 'success-message';
    successMsg.innerHTML = `
      <i class="fas fa-check-circle"></i>
      <span>Profile updated successfully!</span>
    `;
    document.body.appendChild(successMsg);
    
    // Remove success message after 3 seconds
    setTimeout(() => {
      successMsg.style.opacity = '0';
      setTimeout(() => successMsg.remove(), 300);
    }, 3000);
    
    // Update teacher name in notice form
    document.getElementById("teacherName").value = `${firstname} ${surname}`.trim();
    
  } catch (error) {
    loadingOverlay.remove();
    console.error("Error updating profile:", error);
    let errorMessage = "Error updating profile";
    
    // Handle specific Firebase errors
    if (error.code) {
      switch(error.code) {
        case "auth/requires-recent-login":
          errorMessage = "Please reauthenticate to change password";
          break;
        case "auth/weak-password":
          errorMessage = "Password should be at least 8 characters";
          break;
        default:
          errorMessage = error.message;
      }
    }
    
    showError(errorMessage);
  }
});    /* --------------------- Initialize Grades Form --------------------- */
      document.getElementById("gradeForm")?.addEventListener("submit", async (e) => {
        e.preventDefault();
        const studentEmail = document.getElementById("gradeStudent").value;
        const studentClass = document.getElementById("studentClass").value;
        const year = document.getElementById("gradeYear").value;
        const term = document.getElementById("gradeTerm").value;
        const finalGrade = document.getElementById("finalGrade").value;
        
        if (!studentEmail || !studentClass || !year || !term || !finalGrade) {
          showNotification("Please fill all required fields", "error");
          return;
        }
        
        const docId = `${studentEmail}_${year}_${term}`;
        try {
          await setDoc(doc(db, "grades", docId), {
            studentEmail,
            studentClass,
            year,
            term,
            finalGrade,
            lastUpdated: new Date()
          });
          
          document.getElementById("gradeResult").innerHTML = `
            <div class="notification success">
              <i class="fas fa-check-circle"></i> Grade saved successfully!
            </div>
          `;
          
          // Reset form
          document.getElementById("gradeForm").reset();
        } catch (error) {
          console.error("Error saving grade:", error);
          document.getElementById("gradeResult").innerHTML = `
            <div class="notification error">
              <i class="fas fa-exclamation-circle"></i> Error saving grade: ${error.message}
            </div>
          `;
        }
      });

     // Initialize dashboard stats
loadTeacherStats(); 
    </script>
  </body>
</html>
